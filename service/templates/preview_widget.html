{% extends "base.html" %}

{% block extra_head %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/widget.editor.css') }}">
{% endblock %}

{% block content %}

{% include '_preview-status.html' %}

<div id="widget-editor"></div>

{% endblock %}


{% block extra_js_bottom %}

{% include 'includes/reactordb.nodeps.full.js.html' %}

<script type="text/javascript" src="{{url_for('static', filename='js/reactordbadmin.js')}}"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/widget.editor.js')}}"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/widget.js')}}"></script>

<script type="text/javascript">
jQuery(document).ready(function($) {
    var current_domain = document.location.host;
    var current_scheme = window.location.protocol;
    var BASE_URL = current_scheme + "//" + current_domain;

    /*
    $("#widget-editor").on("edges:post-init", function() {
        reactordbadmin.base_url = BASE_URL;
        reactordbadmin.selector = "#widget-editor";
        reactordbadmin.requestStatus();
    });*/

    rdbwidgets.editor({
        selector: "#widget-editor",
        index: "preview_reactor",
        base : BASE_URL,
        include: "/embed.html"
    });

    /*
    $("#generic-report").on("edges:post-render", function() {
        var urlParams = reactordb.activeEdges["#generic-report"].urlParams;
        var source = reactordb.activeEdges["#generic-report"].currentQuery.objectify({
            include_aggregations: false,
            include_sort: false,
            include_paging: false,
            include_fields: false
        });
        $("input[name=source]").val(JSON.stringify(source));
        if (urlParams.hasOwnProperty("title")) {
            $("input[name=title]").val(urlParams["title"]);
        }
        if (urlParams.hasOwnProperty(("show"))) {
            $("textarea[name=show]").val(urlParams["show"].replace(/[\+]/g, " "));
        }
        if (urlParams.hasOwnProperty("ref")) {
            $("input[name=ref]").val(urlParams.ref);
        }

        var shareUrl = BASE_URL + "/preview_generic";
        var params = ["source=" + encodeURIComponent(JSON.stringify(source))];
        for (var key in urlParams) {
            var val = urlParams[key];
            if (val !== "") {
                params.push(encodeURIComponent(key) + "=" + encodeURIComponent(val));
            }
        }
        shareUrl = shareUrl + "?" + params.join("&");
        $("textarea[name=share]").val(shareUrl);
    });
    */

});
</script>

{% endblock%}